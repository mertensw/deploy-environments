name: Deploy Pipeline 1

on:
  workflow_dispatch:
    inputs:
      skip_int:
        type: boolean
        description: "Skip INT deployment"
        default: false
      skip_acc:
        type: boolean
        description: "Skip ACC deployment"
        default: false
      skip_prd:
        type: boolean
        description: "Skip PRD deployment"
        default: false

jobs:
  # --- LOG INPUTS ---
  log-inputs:
    name: Log input parameters
    runs-on: ubuntu-latest
    steps:
    - name: Log workflow inputs
      run: |
        echo "Skip INT: ${{ inputs.skip_int }}"
        echo "Skip ACC: ${{ inputs.skip_acc }}"
        echo "Skip PRD: ${{ inputs.skip_prd }}"
    - name: Validate inputs
      run: |
        if [ "${{ inputs.skip_int }}" = "true" ] && \
           [ "${{ inputs.skip_acc }}" = "true" ] && \
           [ "${{ inputs.skip_prd }}" = "true" ]; then
          echo "âŒ All environments are skipped! Aborting..."
          exit 1
        fi
    - name: Write summary
      run: |
        echo "## ðŸš€ Deployment Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- DEV: âœ… always deployed" >> $GITHUB_STEP_SUMMARY
        echo "- INT: $([[ "${{ inputs.skip_int }}" == "true" ]] && echo "â­ï¸ skipped" || echo "âœ… deployed")" >> $GITHUB_STEP_SUMMARY
        echo "- ACC: $([[ "${{ inputs.skip_acc }}" == "true" ]] && echo "â­ï¸ skipped" || echo "âœ… deployed")" >> $GITHUB_STEP_SUMMARY
        echo "- PRD: $([[ "${{ inputs.skip_prd }}" == "true" ]] && echo "â­ï¸ skipped" || echo "âœ… deployed")" >> $GITHUB_STEP_SUMMARY

  # --- DEV ---
  deploy-dev:
    name: Deploy to DEV
    needs: log-inputs
    runs-on: ubuntu-latest
    environment: dev
    steps:
    - name: Deploy
      run: echo "Deploying to DEV"
    - name: Done marker
      if: always()
      run: echo "DEV complete (always runs)"

  # --- INT ---
  deploy-int:
    name: Deploy to INT
    needs: deploy-dev
    runs-on: ubuntu-latest
    environment: int
    steps:
    - name: Maybe skip
      if: ${{ inputs.skip_int }}
      run: echo "Skipping INT"
    - name: Deploy
      if: ${{ !inputs.skip_int }}
      run: echo "Deploying to INT"
    - name: Done marker
      if: always()
      run: echo "INT complete (skipped or deployed)"

  # --- ACC ---
  deploy-acc:
    name: Deploy to ACC
    needs: deploy-int
    runs-on: ubuntu-latest
    environment: acc
    steps:
    - name: Maybe skip
      if: ${{ inputs.skip_acc }}
      run: echo "Skipping ACC"
    - name: Deploy
      if: ${{ !inputs.skip_acc }}
      run: echo "Deploying to ACC"
    - name: Done marker
      if: always()
      run: echo "ACC complete (skipped or deployed)"

  # --- PRD ---
  deploy-prd:
    name: Deploy to PRD
    needs: deploy-acc
    runs-on: ubuntu-latest
    environment: prd
    steps:
    - name: Maybe skip
      if: ${{ inputs.skip_prd }}
      run: echo "Skipping PRD"
    - name: Deploy
      if: ${{ !inputs.skip_prd }}
      run: echo "Deploying to PRD"
    - name: Done marker
      if: always()
      run: echo "PRD complete (skipped or deployed)"
